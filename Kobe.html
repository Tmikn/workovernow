<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é»‘æ›¼å·´ä¼ å¥‡</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            /* ä½¿ç”¨ svh (Small Viewport Height) ç¡®ä¿åœ¨æœ‰å·¥å…·æ çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å…¨å± */
            height: 100svh; 
            overflow: hidden;
            position: fixed; /* é˜²æ­¢æ©¡çš®ç­‹å›å¼¹æ•ˆæœ */
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* è®¡åˆ†æ¿ */
        #score-board {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 20px;
            border-radius: 10px;
            z-index: 100; /* ç¡®ä¿åœ¨æœ€å‰é¢ */
            pointer-events: auto;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        /* å‘¼å¸ç¯è¾¹æ¡†æ•ˆæœ */
        #score-board {
            animation: board-glow 2s infinite;
        }

        @keyframes board-glow {
            0% { border-color: rgba(155, 64, 158, 0.2); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
            50% { border-color: rgba(155, 64, 158, 0.8); box-shadow: 0 4px 20px rgba(155, 64, 158, 0.4); }
            100% { border-color: rgba(155, 64, 158, 0.2); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        }

        /* å°æç¤ºæ–‡å­—æ ·å¼ */
        .score-tip {
            font-size: 10px;
            color: #9B409E; /* ä½¿ç”¨ä½ è§’è‰²çš„ç´«è‰² */
            font-weight: normal;
            margin-top: 2px;
            text-align: center;
            opacity: 0.8;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-3px); }
            60% { transform: translateY(-1px); }
        }

        /* æ‰‹æœºç«¯é€‚é…ï¼šç¨å¾®ç¼©å°ä¸€ç‚¹é˜²æ­¢æŒ¡ä½æŠ•ç¯® */
        @media (max-width: 600px) {
            #score-board {
                padding: 8px 15px;
                font-size: 18px;
            }
            .score-tip { font-size: 9px; }
        }

        /* æ‰‹æœºç«¯æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        #controls {
            position: absolute;
            /* env(safe-area-inset-bottom) è‡ªåŠ¨é¢„ç•™ iPhone åº•éƒ¨æ¨ªæ¡çš„é«˜åº¦ */
            bottom: calc(15px + env(safe-area-inset-bottom));
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 15px;
            box-sizing: border-box;
            z-index: 10;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .ctrl-btn {
            width: 55px;
            height: 55px;
            background: rgba(255, 255, 255, 0.3); /* è°ƒäº®ä¸€ç‚¹ï¼Œçœ‹å¾—æ›´æ¸… */
            border: 1.5px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            color: white;
            font-size: 22px;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
            
             /* --- æ ¸å¿ƒå…¼å®¹æ€§å±æ€§ --- */
            -webkit-user-select: none;  /* Safari, Chrome, Opera */
            -moz-user-select: none;     /* Firefox */
            -ms-user-select: none;      /* Internet Explorer/Edge (æ—§ç‰ˆ) */
            user-select: none;          /* æ ‡å‡†å±æ€§ (ç°ä»£æµè§ˆå™¨) */
            
            /* é¢å¤–ä¿é™©ï¼šé˜²æ­¢ç§»åŠ¨ç«¯é•¿æŒ‰å¼¹å‡ºç³»ç»Ÿèœå• */
            -webkit-touch-callout: none;
        }

        .ctrl-btn:active, .ctrl-btn.active {
            background: rgba(0, 0, 0, 0.5);
            transform: scale(0.95);
        }

        #back-btn {
            position: fixed;
            /* æ”¾åœ¨æŒ‰é’®ä¸Šæ–¹ï¼Œé¿å…é‡å  */
            bottom: calc(100px + env(safe-area-inset-bottom));
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            color: white;
            text-decoration: none;
            font-size: 0.8rem;
            z-index: 5;
        }

        /* æç¤ºå±‚ */
        #tutorial {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(0,0,0,0.3);
            text-align: center;
            pointer-events: none;
        }

        /* æ’è¡Œ */
        #rank-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 100000;
            display: flex; justify-content: center; align-items: center;
            color: #333;
        }
        .rank-content {
            background: white; padding: 20px; border-radius: 20px;
            width: 85%; max-width: 320px; text-align: center;
        }
        #rank-list { text-align: left; margin: 15px 0; max-height: 200px; overflow-y: auto; }
        .rank-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee; }
        #player-name { padding: 8px; width: 60%; border-radius: 5px; border: 1px solid #ccc; }
        .close-btn { margin-top: 15px; background: #eee; border: none; padding: 8px 20px; border-radius: 10px; }

    </style>
</head>
<body>

    <div id="game-container">
        <div id="score-board">å¾—åˆ†: <span id="score">0</span>
        <div class="score-tip">ç‚¹å‡»æŸ¥çœ‹æ’è¡Œæ¦œ ğŸ†</div>
        </div>
        
        <div id="tutorial">
            ç”µè„‘ï¼šæ–¹å‘é”® â† â†’ ç§»åŠ¨ï¼ŒZ / X æ—‹è½¬<br>
            æ‰‹æœºï¼šä½¿ç”¨ä¸‹æ–¹æŒ‰é’®
        </div>

        <div id="controls">
            <div class="btn-group">
                <div class="ctrl-btn" id="btn-left">â†</div>
                <div class="ctrl-btn" id="btn-right">â†’</div>
            </div>
            <div class="btn-group">
                <div class="ctrl-btn" id="btn-rot-left">â†º</div>
                <div class="ctrl-btn" id="btn-rot-right">â†»</div>
            </div>
        </div>
    </div>

    <div id="rank-modal" style="display: none;">
        <div class="rank-content">
            <h3>ğŸ† æ’è¡Œæ¦œ</h3>
            <div id="rank-list">åŠ è½½ä¸­...</div>
            
            <div id="submit-area">
                <hr>
                <p>æœ¬æ¬¡å¾—åˆ†: <span id="final-score">0</span></p>
                <input type="text" id="player-name" placeholder="è¾“å…¥ä½ çš„å¤§å" maxlength="10">
                <button onclick="submitScore()">ä¸Šæ¦œ</button>
            </div>
            
            <button class="close-btn" onclick="closeRank()">è¿”å›æ¸¸æˆ</button>
        </div>
    </div>

    <script>
        // 1. ç‰©ç†å¼•æ“åˆå§‹åŒ–
        const Engine = Matter.Engine,
              Render = Matter.Render,
              Runner = Matter.Runner,
              Bodies = Matter.Bodies,
              Body = Matter.Body,
              Composite = Matter.Composite,
              Events = Matter.Events,
              Vector = Matter.Vector;

        // åˆ›å»ºå¼•æ“
        const engine = Engine.create();
        const world = engine.world;

        // è·å–å®¹å™¨å®½é«˜
        const container = document.getElementById('game-container');
        let width = container.clientWidth;
        let height = container.clientHeight;

        // åˆ›å»ºæ¸²æŸ“å™¨
        const render = Render.create({
            element: container,
            engine: engine,
            options: {
                width: width,
                height: height,
                wireframes: false, // å…³é—­çº¿æ¡†æ¨¡å¼ï¼Œæ˜¾ç¤ºé¢œè‰²
                background: '#f0f2f5'
            }
        });

        // 2. åˆ›å»ºæ¸¸æˆç‰©ä½“

        // --- å¢™å£ ---
        const wallOptions = { isStatic: true, render: { fillStyle: '#999' } };
        const ground = Bodies.rectangle(width / 2, height + 50, width, 100, wallOptions);
        const leftWall = Bodies.rectangle(-50, height / 2, 100, height * 2, wallOptions);
        const rightWall = Bodies.rectangle(width + 50, height / 2, 100, height * 2, wallOptions);
        Composite.add(world, [ground, leftWall, rightWall]);

        // --- ç©å®¶ (ç»„åˆåˆšä½“) ---
        // é¢œè‰²æå–è‡ªç”¨æˆ·ä¸Šä¼ å›¾ç‰‡
        const headColor = '#A86A4B'; // è¤è‰²
        const bodyColor = '#9B409E'; // ç´«è‰²

        function createPlayer() {
            // å¤´éƒ¨ (åœ†å½¢)
            const headRadius = 20;
            const head = Bodies.circle(0, -25, headRadius, {
                render: { fillStyle: headColor }
            });

            // èº«ä½“ (å€’ä¸‰è§’å½¢)
            // Matter.js çš„ polygon é»˜è®¤æ˜¯æ­£å¤šè¾¹å½¢ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´é¡¶ç‚¹è®©å®ƒçœ‹èµ·æ¥åƒä¸ªå€’ä¸‰è§’
            // è¿™é‡Œç”¨æ¢¯å½¢æ¨¡æ‹Ÿç¨å¾®å¥½æ§åˆ¶ä¸€ç‚¹ï¼Œæˆ–è€…ç›´æ¥ç”¨ä¸‰è§’å½¢
            const bodyPart = Bodies.trapezoid(0, 15, 50, 60, 1, {
                render: { fillStyle: '#9B409E' },
                angle: Math.PI // æ—‹è½¬180åº¦ï¼Œè®©å°–è§’æœä¸‹
            });
            
            // ç»„åˆèµ·æ¥ 
            const player = Body.create({
                parts: [head, bodyPart],
                friction: 0.1,
                frictionAir: 0.05, // å¢åŠ ç©ºæ°”é˜»åŠ›ï¼Œè®©å®ƒä¸æŒ‰é”®æ—¶å®¹æ˜“åœä¸‹
                restitution: 0.2, // å¼¹æ€§
                density: 0.02, // å¯†åº¦ï¼Œå½±å“é‡é‡
            });

            // åˆå§‹ä½ç½®
            Body.setPosition(player, { x: width * 0.2, y: height - 100 });

            // åˆå§‹çŠ¶æ€å¼ºåˆ¶å‚ç›´ï¼Œé˜²æ­¢ä¸€å‡ºç”Ÿå°±å€’äº†
            Body.setAngle(player, 0);

            return player;
        }

        const player = createPlayer();
        Composite.add(world, player);

        // --- ç¯®çƒ ---
        let ball;
        function createBall() {
            if (ball) Composite.remove(world, ball);
            
            ball = Bodies.circle(width * 0.5, height * 0.5, 18, {
                restitution: 1.6, // é«˜å¼¹æ€§
                friction: 0.005,
                density: 0.004,
                render: {
                    fillStyle: '#e67e22',
                    strokeStyle: '#d35400',
                    lineWidth: 3
                },
                label: 'ball'
            });
            Composite.add(world, ball);
        }
        createBall();

        // --- ç¯®ç­ç³»ç»Ÿ ---
        let score = 0;
        const scoreEl = document.getElementById('score');

        // ç¯®ç­ä½ç½®
        const hoopX = width * 0.85;
        const hoopY = height * 0.4;

        function createHoop() {
            const rimColor = '#e74c3c';
            
            // ç¯®æ¿
            const backboard = Bodies.rectangle(hoopX + 40, hoopY - 40, 10, 100, {
                isStatic: true,
                render: { fillStyle: '#ecf0f1' }
            });

            // ç¯®ç­å·¦è¾¹ç¼˜ (å®ä½“)
            const rimLeft = Bodies.circle(hoopX - 35, hoopY, 3, {
                isStatic: true,
                render: { fillStyle: rimColor }
            });

            // ç¯®ç­å³è¾¹ç¼˜ (å®ä½“)
            const rimRight = Bodies.circle(hoopX + 25, hoopY, 3, {
                isStatic: true,
                render: { fillStyle: rimColor }
            });

            // ç¯®ç½‘æ„Ÿåº”å™¨ (ä¸å¯è§ï¼Œç”¨äºæ£€æµ‹è¿›çƒ)
            const netSensor = Bodies.rectangle(hoopX - 5, hoopY + 20, 40, 10, {
                isStatic: true,
                isSensor: true, // ä¼ æ„Ÿå™¨ï¼šåªæ£€æµ‹ç¢°æ’ï¼Œä¸äº§ç”Ÿç‰©ç†ååº”
                render: { visible: false }, // è°ƒè¯•æ—¶è®¾ä¸º true å¯è§
                label: 'sensor'
            });

            Composite.add(world, [backboard, rimLeft, rimRight, netSensor]);
        }
        createHoop();

        // 3. äº¤äº’é€»è¾‘

        // è¾“å…¥çŠ¶æ€
        const keys = {
            left: false,
            right: false,
            rotLeft: false,
            rotRight: false
        };  

        // é”®ç›˜ç›‘å¬
        window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') keys.left = true;
            if (e.key === 'ArrowRight') keys.right = true;
            if (e.key === 'ArrowUp' || e.key === 'z' || e.key === 'Z') keys.rotLeft = true;
            if (e.key === 'ArrowDown' || e.key === 'x' || e.key === 'X') keys.rotRight = true;
        });

        window.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft') keys.left = false;
            if (e.key === 'ArrowRight') keys.right = false;
            if (e.key === 'ArrowUp' || e.key === 'z' || e.key === 'Z') keys.rotLeft = false;
            if (e.key === 'ArrowDown' || e.key === 'x' || e.key === 'X') keys.rotRight = false;
        });

        // è§¦æ‘¸æŒ‰é’®ç›‘å¬
        function setupTouch(id, keyName) {
            const btn = document.getElementById(id);
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[keyName] = true; btn.classList.add('active'); });
            btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[keyName] = false; btn.classList.remove('active'); });
            // å…¼å®¹é¼ æ ‡ç‚¹å‡»æµ‹è¯•
            btn.addEventListener('mousedown', () => { keys[keyName] = true; btn.classList.add('active'); });
            btn.addEventListener('mouseup', () => { keys[keyName] = false; btn.classList.remove('active'); });
        }

        setupTouch('btn-left', 'left');
        setupTouch('btn-right', 'right');
        setupTouch('btn-rot-left', 'rotLeft');
        setupTouch('btn-rot-right', 'rotRight');

        // æ¸¸æˆå¾ªç¯é€»è¾‘
        Events.on(engine, 'beforeUpdate', () => {
            // ç§»åŠ¨åŠ›åº¦
            const moveForce = 0.01;
            const rotSpeed = 0.15;

            // 1. å®šä¹‰ç¯®ç­ä¸­å¿ƒä½ç½®ï¼ˆå’Œä½ åˆ›å»ºç¯®ç­æ—¶çš„åæ ‡ä¸€è‡´ï¼‰
            const hoopCenter = { x: hoopX - 5, y: hoopY }; 

            // 2. ç£åŠ›å‚æ•°
            const attractionStrength = 0.001; // å¸åŠ›å¼ºåº¦ï¼Œä¸è¦è°ƒå¤ªå¤§ï¼Œå¦åˆ™ä¼šåƒç£é“ä¸€æ ·å¸æ­»
            const attractionRange = 80;       // è§¦å‘å¸é™„çš„åŠå¾„è·ç¦»

            // 3. è®¡ç®—åŠ›
            const dX = hoopCenter.x - ball.position.x;
            const dY = hoopCenter.y - ball.position.y;
            const distance = Math.sqrt(dX * dX + dY * dY);

            // å·¦å³ç§»åŠ¨ (ç›´æ¥æ–½åŠ æ°´å¹³åŠ›)
            if (keys.left) {
                Body.applyForce(player, player.position, { x: -moveForce, y: 0 });
            }
            if (keys.right) {
                Body.applyForce(player, player.position, { x: moveForce, y: 0 });
            }

            // æ—‹è½¬æ§åˆ¶ (ç›´æ¥è®¾ç½®è§’é€Ÿåº¦ï¼Œæ‰‹æ„Ÿæ›´ç›´æ¥)
            if (keys.rotLeft) {
                Body.setAngularVelocity(player, -rotSpeed);
            } else if (keys.rotRight) {
                Body.setAngularVelocity(player, rotSpeed);
            }

            // é™åˆ¶ç©å®¶ä¸è¦é£å¤ªé«˜
            if (player.position.y < 0) {
                Body.setPosition(player, { x: player.position.x, y: 0 });
                Body.setVelocity(player, { x: player.velocity.x, y: 0 });
            }
            
            // ä¿æŒç©å®¶å¤§è‡´ç›´ç«‹ (å¦‚æœä¸æŒ‰æ—‹è½¬é”®) - è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„è¾…åŠ©åŠŸèƒ½
            // å¦‚æœä½ æƒ³å¢åŠ éš¾åº¦ï¼Œå¯ä»¥æ³¨é‡Šæ‰ä¸‹é¢è¿™æ®µ
            
            if (!keys.rotLeft && !keys.rotRight) {
                 Body.setAngularVelocity(player, player.angularVelocity * 0.9);
            }
            

            // æ£€æŸ¥çƒæ˜¯å¦å‡ºç•Œ (é‡ç½®)
            if (ball.position.y > height + 100 || ball.position.x > width + 100 || ball.position.x < -100) {
                // å»¶è¿Ÿé‡ç½®
                createBall();
            }
            
            // å¦‚æœçƒåœ¨èŒƒå›´å†…ï¼Œä¸”çƒæ­£åœ¨å‘ä¸‹æ‰ï¼ˆå¢åŠ æ‰‹æ„Ÿï¼Œé˜²æ­¢çƒä»ä¸‹é¢è¢«å¸ä¸Šå»ï¼‰
            if (distance < attractionRange && ball.velocity.y > 0) {
                // è®¡ç®—å½’ä¸€åŒ–çš„æ–¹å‘å‘é‡
                const forceVector = {
                    x: (dX / distance) * attractionStrength,
                    y: (dY / distance) * attractionStrength
                };
                
                // ç»™çƒæ–½åŠ åŠ›
                Body.applyForce(ball, ball.position, forceVector);
                
                // (å¯é€‰) è§†è§‰åé¦ˆï¼šå¸é™„æ—¶çƒå¾®å¾®å˜è‰²
                // ball.render.strokeStyle = '#fff';
            }
        });

        // ç¢°æ’æ£€æµ‹ (å¾—åˆ†)
        Events.on(engine, 'collisionStart', (event) => {
            const pairs = event.pairs;

            for (let i = 0; i < pairs.length; i++) {
                const bodyA = pairs[i].bodyA;
                const bodyB = pairs[i].bodyB;

                // æ£€æŸ¥æ˜¯å¦æ˜¯ çƒ å’Œ ä¼ æ„Ÿå™¨ çš„ç¢°æ’
                if ((bodyA.label === 'ball' && bodyB.label === 'sensor') || 
                    (bodyB.label === 'ball' && bodyA.label === 'sensor')) {
                    
                    // ç®€å•çš„é˜²æŠ–åŠ¨ï¼Œé˜²æ­¢ä¸€æ¬¡è¿›çƒç®—å¤šæ¬¡åˆ†ï¼ˆé€šè¿‡æ£€æŸ¥å‚ç›´é€Ÿåº¦åˆ¤æ–­çƒæ˜¯å¾€ä¸‹è½ï¼‰
                    if (ball.velocity.y > 0) {
                        score += 1;
                        scoreEl.innerText = score;
                        
                        // è¿›çƒç‰¹æ•ˆï¼šçƒå˜ç»¿
                        ball.render.fillStyle = '#2ecc71';
                        
                        // 1ç§’åç”Ÿæˆæ–°çƒ
                        setTimeout(() => {
                            createBall();
                        }, 1000);
                    }
                }
            }
        });

        // å¯åŠ¨å¼•æ“
        Render.run(render);
        const runner = Runner.create();
        Runner.run(runner, engine);

        // çª—å£å¤§å°æ”¹å˜é€‚é…
        window.addEventListener('resize', () => {
            width = container.clientWidth;
            height = container.clientHeight;
            render.canvas.width = width;
            render.canvas.height = height;
            // é‡æ–°å®šä½åœ°é¢å’Œå¢™å£ (ç®€å•èµ·è§ï¼Œè¿™é‡Œå»ºè®®åˆ·æ–°é¡µé¢ï¼Œæˆ–è€…ç¼–å†™å¤æ‚çš„é‡å®šä½é€»è¾‘)
            location.reload(); 
        });

        // 1. åˆå§‹åŒ– Supabase (æ³¨æ„è¿™é‡Œç›´æ¥ç”¨ supabasejs æä¾›çš„ createClient)
        const supabaseUrl = 'https://hnzrjedtrjxgdverackz.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhuenJqZWR0cmp4Z2R2ZXJhY2t6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMzQxNjIsImV4cCI6MjA4NTkxMDE2Mn0.ZK5y7uGXJ-nqednVzK7wL1GTxmA4DQSq34IcO88GcgQ';

        // è¿™é‡Œçš„å˜é‡åå»ºè®®æ”¹ä¸€ä¸‹ï¼Œé¿å…å’Œåº“åå†²çª
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey); 
        // æˆ–è€…å¦‚æœæ˜¯ç›´æ¥å¼•å…¥çš„ CDNï¼Œé€šå¸¸æ˜¯ï¼š
        // const _supabase = supabase.createClient(supabaseUrl, supabaseKey);


        // æ¸¸æˆç»“æŸæˆ–ç‚¹å‡»å¾—åˆ†æ¿æ—¶è§¦å‘
        function showRank() {
            document.getElementById('rank-modal').style.display = 'flex';
            document.getElementById('final-score').innerText = score;
            loadRank();
        }

        // 2. åŠ è½½æ’è¡Œæ¦œ
        async function loadRank() {
            const listDiv = document.getElementById('rank-list');
            listDiv.innerHTML = "<div style='text-align:center'>é»‘æ›¼å·´ç¥ˆç¥·ä¸­...</div>";

            const { data, error } = await _supabase
                .from('Leaderboard')
                .select('username, score')
                .order('score', { ascending: false })
                .limit(10);

            if (error) {
                listDiv.innerHTML = "<div style='color:red'>åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ</div>";
                console.error(error);
                return;
            }

            let html = "";
            if (data.length === 0) {
                html = "<div style='text-align:center'>è™šä½ä»¥å¾…ï¼Œå¿«æ¥å é¢†æ¦œé¦–ï¼</div>";
            } else {
                data.forEach((item, index) => {
                    let medal = index === 0 ? "ğŸ¥‡ " : index === 1 ? "ğŸ¥ˆ " : index === 2 ? "ğŸ¥‰ " : (index + 1) + ". ";
                    html += `<div class="rank-item">
                        <span>${medal}${item.username}</span>
                        <b>${item.score} åˆ†</b>
                    </div>`;
                });
            }
            listDiv.innerHTML = html;
        }

        // æäº¤åˆ†æ•°
        async function submitScore() {
            const nameInput = document.getElementById('player-name');
            const name = nameInput.value.trim();
            if (!name) return alert("è¯·è¾“å…¥ID");

            const btn = document.querySelector('#submit-area button');
            btn.disabled = true;
            btn.innerText = "æ­£åœ¨ä¸Šæ¦œ...";

            const { error } = await _supabase
                .from('Leaderboard')
                .insert([{ username: name, score: score }]);

            if (error) {
                alert("æ•°æ®åº“é“¾æ¥å¤±è´¥");
                btn.disabled = false;
                btn.innerText = "é‡è¯•";
            } else {
                alert("æ’è¡Œæ¦œå·²æ›´æ–°");
                nameInput.value = ""; // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('submit-area').style.display = 'none';
                loadRank();
            }
        }

        function closeRank() {
            document.getElementById('rank-modal').style.display = 'none';
        }

        // ä¿®æ”¹ä½ åŸæ¥çš„å¾—åˆ†ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»å¾—åˆ†å¯ä»¥çœ‹æ’è¡Œ
        document.getElementById('score-board').onclick = showRank;

    </script>


</body>
</html>